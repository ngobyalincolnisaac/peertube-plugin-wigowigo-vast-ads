/*! @name videojs-contrib-ads @version 6.9.0-custom @license Apache-2.0 */
!function(e,t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js"),require("global/window"),require("global/document")):"function"==typeof define&&define.amd?define(["video.js","global/window","global/document"],t):(e=e||self).videojsContribAds=t(e.videojs,e.window,e.document)}(this,function(e,t,n){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n;

var VERSION = "6.9.0-custom";

// --- UTILITY ---
function safePlay(player){
    var p = player.play();
    if(p && p.catch) p.catch(()=>{}); // ignore NotAllowedError
}
function muteForAutoplay(player){
    if(player.autoplay() && !player.muted()){
        player.volume(0);
        player.muted(true);
    }
}

// --- STATES ---
var BaseState = function(){
    function t(player){this.player=player}
    t.prototype.init=function(){}
    t.prototype.cleanup=function(){}
    t.prototype.handleEvent=function(event){
        switch(event.type){
            case "play": this.onPlay(); break;
            case "adsready": this.onAdsReady(); break;
            case "adserror": this.onAdsError(); break;
            case "adscanceled": this.onAdsCanceled(); break;
            case "adtimeout": this.onAdTimeout(); break;
            case "ads-ad-started": this.onAdStarted(); break;
            case "contentchanged": this.onContentChanged(); break;
            case "contentresumed": this.onContentResumed(); break;
            case "readyforpostroll": this.onReadyForPostroll(); break;
            case "playing": this.onPlaying(); break;
            case "ended": this.onEnded(); break;
            case "nopreroll": this.onNoPreroll(); break;
            case "nopostroll": this.onNoPostroll(); break;
            case "adended": this.onAdEnded(); break;
        }
    }
    t.prototype.onPlay=function(){}
    t.prototype.onAdsReady=function(){}
    t.prototype.onAdsError=function(){}
    t.prototype.onAdsCanceled=function(){}
    t.prototype.onAdTimeout=function(){}
    t.prototype.onAdStarted=function(){}
    t.prototype.onContentChanged=function(){}
    t.prototype.onContentResumed=function(){}
    t.prototype.onReadyForPostroll=function(){}
    t.prototype.onNoPreroll=function(){}
    t.prototype.onNoPostroll=function(){}
    t.prototype.onAdEnded=function(){}
    t.prototype.onPlaying=function(){}
    t.prototype.onEnded=function(){}
    t.prototype.startLinearAdMode=function(){}
    t.prototype.endLinearAdMode=function(){}
    t.prototype.skipLinearAdMode=function(){}
    t.prototype.isAdState=function(){return !1}
    t.prototype.isWaitingForAdBreak=function(){return !1}
    t.prototype.isContentResuming=function(){return !1}
    t.prototype.inAdBreak=function(){return !1}
    return t
}();

var AdStateManager = { states_:{}, registerState:function(name,cls){this.states_[name]=cls;return cls}, getState:function(name){return this.states_[name]} };

// --- PREROLL ---
var Preroll = function(t){
    function n(){var e=t.apply(this,arguments)||this;return e.waitingForAdBreak=!0,e}
    n.prototype = Object.create(t.prototype);
    n.prototype.constructor = n;
    n.prototype.init=function(){
        this.waitingForAdBreak=true;
        muteForAutoplay(this.player);
        var player=this.player;
        var timeout = player.ads.settings.prerollTimeout || 5000;
        this._timeout = player.setTimeout(()=>{ player.trigger("adtimeout"); }, timeout);
    };
    n.prototype.startLinearAdMode=function(){
        var player=this.player;
        player.ads.adType="preroll";
        this.waitingForAdBreak=false;
        player.ads.preAdVolume_ = player.volume();
        player.addClass("vjs-ad-playing");
        safePlay(player);
    };
    n.prototype.endLinearAdMode=function(){
        var player=this.player;
        player.removeClass("vjs-ad-playing");
        if(player.ads.preAdVolume_!==undefined){
            player.volume(player.ads.preAdVolume_);
            player.muted(false);
        }
        safePlay(player); // resume content
    };
    return n;
}(BaseState);

AdStateManager.registerState("Preroll",Preroll);

// --- MIDROLL ---
var Midroll = function(t){
    function n(){return t.apply(this,arguments)||this}
    n.prototype = Object.create(t.prototype);
    n.prototype.constructor = n;
    n.prototype.init=function(){
        this.player.on("timeupdate",()=>{
            var player=this.player;
            if(player.currentTime() >= (player.ads.midrollTime || 10) && !player.ads._midrollPlayed){
                this.startLinearAdMode();
                player.ads._midrollPlayed=true;
            }
        });
    };
    n.prototype.startLinearAdMode=function(){
        var player=this.player;
        player.ads.adType="midroll";
        player.ads.preAdVolume_ = player.volume();
        player.addClass("vjs-ad-playing");
        safePlay(player);
    };
    n.prototype.endLinearAdMode=function(){
        var player=this.player;
        player.removeClass("vjs-ad-playing");
        if(player.ads.preAdVolume_!==undefined){
            player.volume(player.ads.preAdVolume_);
            player.muted(false);
        }
        safePlay(player); // resume content
    };
    return n;
}(BaseState);

AdStateManager.registerState("Midroll",Midroll);

// --- POSTROLL ---
var Postroll = function(t){
    function n(){return t.apply(this,arguments)||this}
    n.prototype = Object.create(t.prototype);
    n.prototype.constructor = n;
    n.prototype.init=function(){}
    n.prototype.startLinearAdMode=function(){
        var player=this.player;
        player.ads.adType="postroll";
        player.ads.preAdVolume_ = player.volume();
        player.addClass("vjs-ad-playing");
        safePlay(player);
    };
    n.prototype.endLinearAdMode=function(){
        var player=this.player;
        player.removeClass("vjs-ad-playing");
        if(player.ads.preAdVolume_!==undefined){
            player.volume(player.ads.preAdVolume_);
            player.muted(false);
        }
    };
    return n;
}(BaseState);

AdStateManager.registerState("Postroll",Postroll);

// --- CONTENT PLAYBACK ---
var ContentPlayback = function(t){
    function n(){return t.apply(this,arguments)||this}
    n.prototype = Object.create(t.prototype);
    n.prototype.constructor = n;
    n.prototype.init=function(){
        this.player.ads._shouldBlockPlay=false;
    };
    n.prototype.startLinearAdMode=function(){
        var player=this.player;
        if(!player.ads._midrollPlayed){
            var midroll = new (AdStateManager.getState("Midroll"))(player);
            midroll.init();
            player.ads._currentAdState=midroll;
        }
    };
    return n;
}(BaseState);

AdStateManager.registerState("ContentPlayback",ContentPlayback);

// --- PLUGIN INIT ---
var defaultSettings = {
    prerollTimeout:5000,
    postrollTimeout:5000,
    midrollTime:10,
    debug:false
};

var AdsPlugin = function(options){
    var player=this;
    player.ads = player.ads || {};
    player.ads.settings = e.mergeOptions(defaultSettings, options || {});

    // Start with preroll
    var preroll = new (AdStateManager.getState("Preroll"))(player);
    player.ads._currentAdState = preroll;
    preroll.init();

    ["play","playing","ended","adsready","adscanceled","adskip","adserror","adtimeout","adended","ads-ad-started","contentchanged","dispose","contentresumed","readyforpostroll","nopreroll","nopostroll"].forEach(function(ev){
        player.on(ev,function(event){
            if(player.ads._currentAdState)
                player.ads._currentAdState.handleEvent({type:ev});
        });
    });

    player.ready(function(){
        muteForAutoplay(player);
        safePlay(player);
    });
};

AdsPlugin.VERSION = VERSION;
(e.registerPlugin||e.plugin)("ads",AdsPlugin);

return AdsPlugin;
});
